<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whisper Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="../static/css/chat.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body>
<div class="app-container">
    <aside class="sidebar">
        <div class="profile-section">
            <div class="profile-picture-container">
                <img
                        src="{{ .picture }}"
                        alt="Profile Picture of {{ .nickname }}"
                        class="shadow"
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <i
                        class="fa fa-user-circle fa-3x text-light"
                        style="display: none;"></i>
            </div>
            <h2 id="nickname">{{ .nickname }}</h2>
        </div>


        <div class="contacts-section">
            <div class="contact-search">
                <input type="text" id="contactSearch" placeholder="Search contacts..."
                       class="form-control-dark">
            </div>
            <div class="contact-list" id="contactList"></div>
        </div>

        <button id="logout" class="btn">Logout</button>
    </aside>

    <div id="vanta-container">
        <main class="chat-area" id="chat-area">

        </main>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vanta/0.5.24/vanta.birds.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

<script type="module">
    import { ChatApp } from '../static/js/app.js';

    document.addEventListener('DOMContentLoaded', () => {
        const nickname = '{{ .nickname }}';
        window.chatApp = new ChatApp(nickname);

        document.getElementById('logout').addEventListener('click', () => {
            window.location.href = '/logout';
        });

        try {
            VANTA.BIRDS({
                el: "#vanta-container",
                mouseControls: true,
                touchControls: true,
                gyroControls: false,
                minHeight: 200.00,
                minWidth: 200.00,
                scale: 1.00,
                scaleMobile: 1.00,
                backgroundColor: 0x17252A,
                color1: 0x3AAFA9,
                color2: 0xDEF2F1,
                colorMode: "variance",
                birdSize: 1.50,
                wingSpan: 25.00,
                speedLimit: 5.00,
                separation: 30.00,
                alignment: 50.00
            });
        } catch (error) {
            console.error("Error initializing VANTA effect:", error);
        }
    });
</script>
</body>
</html>